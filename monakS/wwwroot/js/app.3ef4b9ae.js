(function(e){function t(t){for(var r,o,c=t[0],s=t[1],u=t[2],l=0,d=[];l<c.length;l++)o=c[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);p&&p(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,o=1;o<n.length;o++){var s=n[o];0!==a[s]&&(r=!1)}r&&(i.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={app:0},i=[];function o(e){return c.p+"js/"+({about:"about"}[e]||e)+"."+{about:"fd1c45e3"}[e]+".js"}function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=a[e]=[t,r]}));t.push(n[2]=r);var i,s=document.createElement("script");s.charset="utf-8",s.timeout=120,c.nc&&s.setAttribute("nonce",c.nc),s.src=o(e);var u=new Error;i=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=a[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",u.name="ChunkLoadError",u.type=r,u.request=i,n[1](u)}a[e]=void 0}};var l=setTimeout((function(){i({type:"timeout",target:s})}),12e4);s.onerror=s.onload=i,document.head.appendChild(s)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var p=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"100f":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("b64b"),n("96cf");var r=n("1da1"),a=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-main",[n("router-view")],1)],1)},o=[],c=n("e87a"),s={name:"App",mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("production"),console.log(e.SERVER_URL);case 2:case"end":return t.stop()}}),t)})))()},data:function(){return{}}},u=s,l=(n("034f"),n("2877")),p=n("6544"),d=n.n(p),m=n("7496"),f=n("f6c4"),v=Object(l["a"])(u,i,o,!1,null,null,null),h=v.exports;d()(v,{VApp:m["a"],VMain:f["a"]});n("d3b7");var g=n("8c4f"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},e._l(e.cameras,(function(t,r){return n("div",{key:r},[n("VideoPlayer",{attrs:{cam:t,stream:e.streams[t.id]}})],1)})),0)},w=[],y=(n("ac1f"),n("5319"),n("b85c")),C=n("8785"),A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{position:"relative"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.overlay,expression:"overlay"}],staticClass:"headline font-weight-bold overlay",staticStyle:{top:"5%",left:"50%"}},[e._v(" "+e._s(e.cam.name)+" ")]),n("span",{directives:[{name:"show",rawName:"v-show",value:e.cam.isObjectDetectionEnabled,expression:"cam.isObjectDetectionEnabled"}],staticClass:"overlay",staticStyle:{top:"5%",right:"0px"}},[n("v-icon",{attrs:{color:"orange"}},[e._v("mdi-motion-sensor")])],1),n("DetectionCanvas",{attrs:{cam:e.cam}}),n("span",{directives:[{name:"show",rawName:"v-show",value:e.motionCaptureActive||e.timerCaptureActive||e.manualCaptureActive,expression:"motionCaptureActive || timerCaptureActive || manualCaptureActive"}],staticClass:"overlay",staticStyle:{top:"5%",right:"40px"}},[n("v-icon",{attrs:{color:e.manualCaptureActive?"red":"orange"}},[e._v("mdi-record-circle")])],1),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.overlay,expression:"overlay"}],staticStyle:{bottom:"20px"},attrs:{color:e.manualCaptureActive?"red":e.captureActive?"orange":"green",dark:"",fab:"",absolute:"",left:""},on:{click:function(t){return e.toggleCapture(e.cam)}}},[n("v-icon",[e._v("mdi-camera")])],1),n("video",{directives:[{name:"hold",rawName:"v-hold.500",value:function(){e.overlay=!e.overlay},expression:"\n      () => {\n        overlay = !overlay;\n      }\n    ",modifiers:{500:!0}}],attrs:{autoplay:"",muted:"",playsinline:""},domProps:{muted:!0,srcObject:e.stream}})],1)},x=[],O=(n("4de4"),n("45fc"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{"pointer-events":"none"}},[n("transition",{attrs:{name:"fade"}},[n("canvas",{ref:"canvas",staticClass:"overlay"})])],1)}),k=[],R={name:"DetectionCanvas",props:{cam:Object},methods:{detectionResult:function(e){var t=this,n=e.cam,r=e.summary;if(n.id==this.cam.id){var a=this.$refs.canvas,i=a.getContext("2d");a.width=a.clientWidth,a.height=a.clientHeight,this.visible=!0,this.lastMsg=e,setTimeout((function(){t.lastMsg==e&&(i.clearRect(0,0,a.width,a.height),i.stroke(),t.visible=!1)}),2e3),i.clearRect(0,0,a.width,a.height),i.stroke();var o,c=r.detections.filter((function(e){return"person"==e.label})),s=Object(y["a"])(c);try{for(s.s();!(o=s.n()).done;){var u=o.value;console.log("detected");var l=a.width*u.left,p=a.height*u.top,d=a.width*u.right-l,m=a.height*u.bottom-p;i.lineWidth=4,i.strokeStyle="#E6007E",i.strokeRect(l,p,d,m),i.strokeStyle="black",i.fillStyle="#E6007E",i.font="bold 16px monospace",i.strokeText(u.label.toUpperCase(),l,p),i.fillText(u.label.toUpperCase(),l,p),i.stroke()}}catch(f){s.e(f)}finally{s.f()}}}},mounted:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.SIGNAL_R.on("detectionResultMessage",e.detectionResult);case 1:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.SIGNAL_R.off("detectionResultMessage",this.detectionResult)},data:function(){return{visible:!1,lastMsg:{}}}},j=R,_=(n("5a8f"),Object(l["a"])(j,O,k,!1,null,"09e54d17",null)),S=_.exports,E=n("9530"),N=n.n(E);function I(){var e=Object(C["a"])(["\n          subscription($id: Int!) {\n            onActiveCapturesChanged(\n              where: { isActive: { eq: true }, cam: { id: { eq: $id } } }\n            ) {\n              isActive\n              trigger\n              name\n              cam {\n                id\n              }\n            }\n          }\n        "]);return I=function(){return e},e}function M(){var e=Object(C["a"])(["\n        query($id: Int!) {\n          captures(\n            where: { isActive: { eq: true }, cam: { id: { eq: $id } } }\n          ) {\n            isActive\n            trigger\n            name\n            cam {\n              id\n            }\n          }\n        }\n      "]);return M=function(){return e},e}var P={name:"VideoPlayer",props:{stream:MediaStream,isInteractive:Boolean,cam:Object},components:{DetectionCanvas:S},apollo:{captures:{query:N()(M()),subscribeToMore:{document:N()(I()),variables:function(){return{id:this.cam.id}},updateQuery:function(e,t){var n=this,r=t.subscriptionData,a=r.data.onActiveCapturesChanged;return console.log(a),a=a.filter((function(e){return e.cam.id==n.cam.id})),{captures:a}}},variables:function(){return{id:this.cam.id}},result:function(e){var t=e.data.captures;t&&(this.motionCaptureActive=t.some((function(e){return"MOTION"==e.trigger})),this.manualCaptureActive=t.some((function(e){return"MANUAL"==e.trigger})),this.timerCaptureActive=t.some((function(e){return"TIMER"==e.trigger})))}}},computed:{captureActive:function(){return this.motionCaptureActive||this.timerCaptureActive||this.manualCaptureActive}},methods:{toggleCapture:function(){this.manualCaptureActive?this.SIGNAL_R.invoke("stopCapture",this.cam):this.SIGNAL_R.invoke("startCapture",this.cam)},captureStarted:function(e){var t=e.info;t.cam.id==this.cam.id&&("motion"==t.trigger?this.motionCaptureActive=!0:"manual"==t.trigger?this.manualCaptureActive=!0:"timer"==t.trigger&&(this.timerCaptureActive=!0))},captureResult:function(e){var t=e.info;t.cam.id==this.cam.id&&("motion"==t.trigger?this.motionCaptureActive=!1:"manual"==t.trigger?this.manualCaptureActive=!1:"timer"==t.trigger&&(this.timerCaptureActive=!1))}},data:function(){return{overlay:!1,motionCaptureActive:!1,manualCaptureActive:!1,timerCaptureActive:!1}}},L=P,q=(n("749a"),n("8336")),T=n("132d"),$=Object(l["a"])(L,A,x,!1,null,"68af4c57",null),D=$.exports;function G(){var e=Object(C["a"])(["\n        query {\n          cameras {\n            name\n            id\n            isObjectDetectionEnabled\n          }\n        }\n      "]);return G=function(){return e},e}d()($,{VBtn:q["a"],VIcon:T["a"]});var V={name:"Home",components:{VideoPlayer:D},apollo:{cameras:{query:N()(G()),result:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=Object(y["a"])(t.cameras),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return a=r.value,e.next=7,t.connect(a);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))()}}},methods:{connect:function(e,t){var n=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var a,i,o,c,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=new RTCPeerConnection,a.ontrack=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(r){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=r.streams[0],n.$set(n.streams,e.id,a);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),a.onicecandidate=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.candidate){e.next=3;break}return e.next=3,n.SIGNAL_R.invoke("setCandidate",i,t.candidate);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.next=5,n.SIGNAL_R.invoke("getSessionId",e);case 5:return i=t.sent,t.next=8,n.SIGNAL_R.invoke("getOffer",i);case 8:return o=t.sent,t.next=11,a.setRemoteDescription({type:"offer",sdp:o});case 11:return t.next=13,a.createAnswer();case 13:return c=t.sent,t.next=16,a.setLocalDescription(c);case 16:return s=a.localDescription.sdp,s=s.replace("a=fmtp:102 profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1\r\n",""),t.next=20,n.SIGNAL_R.invoke("setAnswer",i,s);case 20:case"end":return t.stop()}}),t)})))()}},data:function(){return{streams:[]}}},H=V,U=Object(l["a"])(H,b,w,!1,null,null,null),B=U.exports;a["a"].use(g["a"]);var J=[{path:"/",name:"Home",component:B},{path:"/about",name:"About",component:function(){return n.e("about").then(n.bind(null,"f820"))}}],W=new g["a"]({routes:J}),z=W,Q=n("f309");a["a"].use(Q["a"]);var F=new Q["a"]({theme:{dark:!0}}),K=n("5530"),X=n("522d"),Y=n("efe7");a["a"].use(X["a"]);var Z="apollo-token",ee="127.0.0.1:5000/",te="http://"+ee+"graphql",ne="ws://"+ee+"graphql",re=te,ae={httpEndpoint:re,wsEndpoint:ne,tokenName:Z,persisting:!1,websocketsOnly:!1,ssr:!1};function ie(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(Y["createApolloClient"])(Object(K["a"])(Object(K["a"])({},ae),e)),n=t.apolloClient,r=t.wsClient;n.wsClient=r;var a=new X["a"]({defaultClient:n,defaultOptions:{$query:{}},errorHandler:function(e){console.log("%cError","background: red; color: white; padding: 2px 4px; border-radius: 3px; font-weight: bold;",e.message)}});return a}a["a"].config.productionTip=!1;var oe="/";a["a"].prototype.SERVER_URL=oe;var ce=(new c["a"]).withUrl(oe+"msg").build();function se(){return ue.apply(this,arguments)}function ue(){return ue=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ce.stop();case 2:return e.next=4,ce.start();case 4:new a["a"]({router:z,vuetify:F,apolloProvider:ie(),render:function(e){return e(h)}}).$mount("#app");case 5:case"end":return e.stop()}}),e)}))),ue.apply(this,arguments)}a["a"].prototype.SIGNAL_R=ce,a["a"].directive("hold",{bind:function(e,t){if("function"===typeof t.value){var n=t.modifiers?Object.keys(t.modifiers)[0]:500,r=new Hammer.Manager(e),a=new Hammer.Press({time:n});r.add(a),r.on("press",t.value)}}}),se()},"5a8f":function(e,t,n){"use strict";n("e856")},"749a":function(e,t,n){"use strict";n("100f")},"85ec":function(e,t,n){},e856:function(e,t,n){}});
//# sourceMappingURL=app.3ef4b9ae.js.map